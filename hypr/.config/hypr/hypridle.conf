# ~/.config/hypr/hypridle.conf
general {
    lock_cmd = pidof hyprlock || hyprlock
    before_sleep_cmd = hyprlock
    after_sleep_cmd = hyprctl dispatch dpms on
}

# 1. Warning: Locking in 30 seconds
listener {
    timeout = 270
    on-timeout = notify-send "Locking in 30 secondsâ€¦" "Move mouse or press a key to cancel" -a hypridle -u low -i system-lock-screen -t 5000
}

# 2. Lock screen + random wallpaper
listener {
    timeout = 300
    on-timeout = ~/.config/hypr/scripts/random-lock-wallpaper.sh && hyprlock
}

# 3. Turn off keyboard backlight (skip if media playing)
listener {
    timeout = 300
    on-timeout = sh -c '
        if ! playerctl status 2>/dev/null | grep -q Playing; then
            brightnessctl -d rgb:kbd_backlight set 0
        fi
    '
}

# 4. Turn off screen (DPMS)
listener {
    timeout = 360
    on-timeout = hyprctl dispatch dpms off
    on-resume = hyprctl dispatch dpms on
}

# 5. Suspend
listener {
    timeout = 600
    on-timeout = hyprlock && systemctl suspend
}

# 6. Restore keyboard backlight on any resume
listener {
    timeout = 0
    on-resume = sh -c '
        brightnessctl -d rgb:kbd_backlight set 100% 2>/dev/null || true
    '
}
